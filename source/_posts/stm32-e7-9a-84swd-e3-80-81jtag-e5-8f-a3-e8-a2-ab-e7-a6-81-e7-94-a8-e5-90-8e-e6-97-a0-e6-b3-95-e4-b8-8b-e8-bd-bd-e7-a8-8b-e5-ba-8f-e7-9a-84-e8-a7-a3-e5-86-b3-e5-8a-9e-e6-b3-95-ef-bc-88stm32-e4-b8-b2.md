---
title: STM32的SWD、JTAG口被禁用后无法下载程序的解决办法（STM32串口下载程序的方法）
tags:
  - BOOT
  - BOOTLOADER
  - FLYMCU
  - JTAG
  - STM32
  - SWD
  - 串口
url: 1258.html
id: 1258
comments: false
categories:
  - STM32
  - 单片机
  - 嵌入式
  - 开发环境
  - 电子工程
date: 2016-09-30 13:01:02
---

        起初来自于一段好奇的尝试，由于正在使用的管脚PA13、PA14、PA15被SWD占用▼：

![gpio](http://oarap.org/wp-content/uploads/2016/09/GPIO.png)

        所以好奇的尝试一下禁用SWD端口（平时一直使用SWD进行下载程序和调试）▼：

GPIO\_PinRemapConfig(GPIO\_Remap\_SWJ\_Disable , ENABLE);

        这样的操作关闭了片上的JTAG和SWD接口，也就是无法进行在线调试▼：

#define GPIO\_Remap\_SWJ\_NoJTRST      ((uint32\_t)0x00300100)  /*!< Full SWJ Enabled (JTAG-DP + SW-DP) but without JTRST */
#define GPIO\_Remap\_SWJ\_JTAGDisable  ((uint32\_t)0x00300200)  /*!< JTAG-DP Disabled and SW-DP Enabled */
#define GPIO\_Remap\_SWJ\_Disable      ((uint32\_t)0x00300400)  /*!< Full SWJ Disabled (JTAG-DP + SW-DP) */

        接下来这次下载程序就成为了SWD的最后一次任务，下载完成后刚刚运行，IDE就会提示“器件不存在，是否结束调试？”，这......

* * *

        于是开始着手使用FlyMCU通过STM32的串口1下载程序：

*   0x00、设置IAR平台下的如何生成HEX，以及找到HEX文件所在的位置▼：

![iar_ouput_hex](http://oarap.org/wp-content/uploads/2016/09/iar_ouput_hex.png)

        所在是工程所在目录下的**Exe**文件夹中

*   0x01、使用FlyMCU下载生成好的HEX文件▼：

![flymcu](http://oarap.org/wp-content/uploads/2016/09/FlyMCU.png)

        STM32F10XXX系列的Bootloader▼：

![stm32f10xxx_bootloader](http://oarap.org/wp-content/uploads/2016/09/STM32F10XXX_BOOTLOADER.png)

*   0x02、却发现FlyMCU一直在和单片机握手中，经查原来是因为BOOT设置的不正确：

        stm32xxxx全系列的启动模式设置▼：

![stm32xxxx_boot_mode](http://oarap.org/wp-content/uploads/2016/09/STM32XXXX_BOOT_MODE.png)

        STM32F103的启动方式配置▼：

![boot_select](http://oarap.org/wp-content/uploads/2016/09/BOOT_SELECT.png)

*   0x03、将BOOT1接0，BOOT0接1，则此时的BootLoader配置成ISP的方式，FlyMCU便可以通过USART1下载程序了

 

* * *

        那么如果用户还想通过SWD/JTAG接口下载程序，我想到两种解决方案：

        1.延迟加载：开机延时3s再进行系统初始化，用户可以在对芯片进行复位后在IDE中点击下载，此时的SWD/JTAG口还没有被禁止，所以下载程序是可以的。

        2.分时复用：在程序中需要使用PA13、PA14、PA15的时候禁用SWD，用完后立即恢复，这样就在程序运行中的大部分时间都是可以下载程序的。

        关于在线调试的解决办法（在禁用了SWD/JTAG的情况下），我还没想到，如果你有更好的解决方案，欢迎留言或邮箱私信：**admin\[at\]oarap.org**。

 

* * *