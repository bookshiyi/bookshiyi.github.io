---
title: STM32F1XX单片机UART4/UART5初始化及错误分析
tags:
  - HardFault_Handler
  - IAR
  - STM32
  - UART
  - 嵌入式
url: 772.html
id: 772
comments: false
categories:
  - STM32
  - 单片机
  - 嵌入式
  - 开发环境
date: 2016-04-25 10:51:07
---

        以STM32f103RCT6为例，该单片机中有5个串行通信模块，构成方式为3+2，所谓3\*USART+2\*UART，即USART、USART2、USART3、UART4和UART5，网络上流传的代码多是配置USART的，当我们移植到UART的模式可能会出现问题，其中一个问题就是在UART在被中断后会死在 **HardFault_Handler** 这里，

![HardFault_Handler](http://oarap.org/wp-content/uploads/2016/04/HardFault_Handler.png)

        后来经过排查发现是底层库的问题，笔者使用的底层库里面包含的**start\_stm32f10x\_md.s**文件中只有USARTx\_IRQHandler，也就是说并没有指向UARTx\_IRQHandler，所以之前定义的UART中断函数就无法被调用。

* * *

解决办法如下：

> #### 移除**start\_stm32f10x\_md.s**
> 
> #### **添加**start\_stm32f10x\_hd.s****
> 
> **![stm32 uart4 uart5](http://oarap.org/wp-content/uploads/2016/04/stm32-uart4-uart5.png)**

可以发现其中包含了UART中断函数，问题解决。